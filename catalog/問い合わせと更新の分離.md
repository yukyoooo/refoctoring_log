# 問い合わせと更新の分離

## 手順
1. 関数をコピーして、問い合わせ用の名前をつける
   - その関数が何を返すかを調べる。問い合わせの結果を変数に設定しているなら、その変数名はいいヒントになるはず
2. 新しい問い合わせ関数から副作用をすべて除去する
3. 静的検査を実行する
4. 元の関数の呼び出しを調べる。戻り値を使っている場合は、その呼び出しを問い合わせ関数の呼び出しに置き換え、元の関数の呼び出しをその後ろに挿入する。変更のたびにテストする
5. 元の関数から戻り値を除去する
6. テストする

```js
function getTotalOutstandingAndSendBill() {
	const result = customer.invoices.reduce((total, each) => each.amount + tatal, 0);
	sendBill();
	return result;
}
```
↓
```js
function totalOutstanding() {
	return customer.invoices.reduce((total, each) => each.amount + total, 0);
}
function sendBill() {
	emailGateway.send(formatBill(customer));
}
```