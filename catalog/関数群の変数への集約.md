# 関数群の変数への集約

## 手順
1. 変更されたレコードを入力とし、同じ値を返す変換関数を作る
   - この関数の中ではレコードのディープコピーが行われる。この変数によって元のレコードが変更されていないことを確認するテストを書くと良い
2. ロジックを選んでその本体を変換関数群に移し、レコードに新たなフィールドを儲ける。そのフィールドを使うようにクライアント川のコードを変更する
   - ロジックが複雑ならば、まず[関数の抽出](関数の抽出.md)を施す
3. テストする
4. そのほかの関連した関数群について上記の手順を繰り返す

```js
function base(aReading) {...}
```
　↓
```js
function enrichReading(argReading) {
	const aReading = _.cloneDeep(argReading);
	aReading.baseCharge = base(aReading);
	aReading.texableCharge = taxableCharge(aReading);
	return aReading;
}
```